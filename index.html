<!DOCTYPE html>
<html>
<head>
    <title>AI Search Browser</title>
    <style>
        .search-container {
            padding: 20px;
            text-align: center;
        }
        .search-box {
            width: 60%;
            padding: 15px;
            font-size: 16px;
        }
        .results-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: left;
        }
        .sponsored-result {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
        }
        .organic-result {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .ai-summary-btn {
            background: #007cba;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }
        .ai-suggestion {
            background: #e7f3ff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .premium-badge {
            background: gold;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="Search with AI...">
        <button onclick="performSearch()">Search</button>
    </div>

    <!-- Ad Container -->
    <div class="ad-container">
        <script type="text/javascript">
            atOptions = {
                'key' : 'search-top-ad',
                'format' : 'smart'
            };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/SEARCH_TOP_CODE/invoke.js"></script>
    </div>

    <div id="searchResults" class="results-container"></div>

    <script>
        // Sponsored websites database
        const sponsoredWebsites = {
            'vps': [
                { name: 'AWS EC2', url: 'https://aws.amazon.com/ec2/', bid: 0.50 },
                { name: 'Google Cloud VPS', url: 'https://cloud.google.com/compute', bid: 0.45 },
                { name: 'Contabo VPS', url: 'https://contabo.com', bid: 0.40 },
                { name: 'DigitalOcean', url: 'https://digitalocean.com', bid: 0.35 }
            ],
            'hosting': [
                { name: 'BlueHost', url: 'https://bluehost.com', bid: 0.30 },
                { name: 'HostGator', url: 'https://hostgator.com', bid: 0.25 }
            ],
            'cloud': [
                { name: 'AWS', url: 'https://aws.amazon.com', bid: 0.60 },
                { name: 'Google Cloud', url: 'https://cloud.google.com', bid: 0.55 },
                { name: 'Microsoft Azure', url: 'https://azure.microsoft.com', bid: 0.50 }
            ]
        };

        async function performSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            resultsDiv.innerHTML = 'Searching...';

            try {
                // Get SearXNG results
                const searxngResults = await fetchSearxngResults(query);
                
                // Get sponsored results
                const sponsored = getSponsoredResults(query);
                
                // Display results
                displayResults(sponsored, searxngResults, query);
                
            } catch (error) {
                resultsDiv.innerHTML = 'Error performing search';
            }
        }

        function getSponsoredResults(query) {
            const sponsored = [];
            
            // Check each category for matches
            Object.keys(sponsoredWebsites).forEach(category => {
                if (query.includes(category)) {
                    sponsored.push(...sponsoredWebsites[category]);
                }
            });
            
            // Sort by bid price (highest first)
            return sponsored.sort((a, b) => b.bid - a.bid).slice(0, 3);
        }

        async function fetchSearxngResults(query) {
            // Your SearXNG instance URL
            const searxngUrl = `http://your-searxng-instance/search?q=${encodeURIComponent(query)}&format=json`;
            
            const response = await fetch(searxngUrl);
            const data = await response.json();
            return data.results || [];
        }

        function displayResults(sponsored, organic, query) {
            const resultsDiv = document.getElementById('searchResults');
            let html = '';

            // Show sponsored results first
            if (sponsored.length > 0) {
                html += '<div class="sponsored-section">';
                html += '<h3>Sponsored Results</h3>';
                
                sponsored.forEach(result => {
                    html += `
                        <div class="sponsored-result">
                            <h4><a href="${result.url}" target="_blank">${result.name}</a> 
                                <span class="premium-badge">Sponsored</span>
                            </h4>
                            <p>Premium cloud hosting solution</p>
                            <button class="ai-summary-btn" onclick="summarizePage('${result.url}')">
                                AI Summary
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                
                // Track sponsored click revenue
                trackSponsoredImpression(sponsored);
            }

            // Show organic results
            html += '<div class="organic-section">';
            html += '<h3>Search Results</h3>';
            
            organic.slice(0, 10).forEach(result => {
                html += `
                    <div class="organic-result">
                        <h4><a href="${result.url}" target="_blank">${result.title}</a></h4>
                        <p>${result.content}</p>
                        <button class="ai-summary-btn" onclick="summarizePage('${result.url}')">
                            AI Summary
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';

            // Add AI suggestions
            html += generateAISuggestions(query);

            resultsDiv.innerHTML = html;
        }

        function generateAISuggestions(query) {
            return `
                <div class="ai-suggestion">
                    <h4>ðŸ’¡ AI Suggestions for "${query}"</h4>
                    <div id="aiSuggestions"></div>
                    <button onclick="getPremiumAISuggestions('${query}')" class="ai-summary-btn">
                        Get Premium AI Insights
                    </button>
                </div>
            `;
        }

        async function getPremiumAISuggestions(query) {
            const suggestionsDiv = document.getElementById('aiSuggestions');
            suggestionsDiv.innerHTML = 'Analyzing with AI...';

            try {
                const response = await fetch('https://cloud.activepieces.com/api/v1/webhooks/6jmp4jCqYOYG2B2zqxXW', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'search_analysis',
                        query: query,
                        type: 'premium_suggestions'
                    })
                });

                const data = await response.json();
                
                // Check if user has premium or show ad
                if (!userHasPremium()) {
                    showAISuggestionAd();
                }
                
                suggestionsDiv.innerHTML = `
                    <strong>AI Analysis:</strong> ${data.analysis}
                    <br><strong>Recommended:</strong> ${data.recommendations}
                `;
                
            } catch (error) {
                suggestionsDiv.innerHTML = 'Error getting AI suggestions';
            }
        }

        async function summarizePage(url) {
            // Show ad before AI summary for non-premium users
            if (!userHasPremium()) {
                showSummaryAd();
            }

            try {
                const response = await fetch('https://cloud.activepieces.com/api/v1/webhooks/6jmp4jCqYOYG2B2zqxXW', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'summarize_url',
                        url: url,
                        type: 'page_summary'
                    })
                });

                const data = await response.json();
                
                // Show summary in modal
                showSummaryModal(data.summary, url);
                
            } catch (error) {
                alert('Error summarizing page');
            }
        }

        function showAISuggestionAd() {
            // Show ad when using premium AI features
            const adHtml = `
                <div class="ad-container">
                    <p>AI Suggestion powered by:</p>
                    <script type="text/javascript">
                        atOptions = {
                            'key' : 'ai-suggestion-ad',
                            'format' : 'smart'
                        };
                    </script>
                    <script type="text/javascript" src="//www.highperformanceformat.com/AI_SUGGESTION_CODE/invoke.js"></script>
                </div>
            `;
            
            document.getElementById('aiSuggestions').insertAdjacentHTML('beforeend', adHtml);
        }

        function showSummaryAd() {
            // Show interstitial ad before summary
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000;">
                    <div style="background:white; margin:100px auto; padding:20px; width:60%;">
                        <h3>AI Summary Powered By</h3>
                        <div id="summaryAdContent"></div>
                        <button onclick="this.parentElement.parentElement.remove()">Continue to Summary</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Load ad in the modal
            const adScript = document.createElement('script');
            adScript.innerHTML = `
                atOptions = {
                    'key' : 'summary-interstitial-ad',
                    'format' : 'smart'
                };
                document.write('<scr' + 'ipt type="text/javascript" src="//www.highperformanceformat.com/SUMMARY_AD_CODE/invoke.js"></scr' + 'ipt>');
            `;
            document.getElementById('summaryAdContent').appendChild(adScript);
        }

        function trackSponsoredImpression(sponsoredResults) {
            // Track revenue from sponsored results
            const totalRevenue = sponsoredResults.reduce((sum, result) => sum + result.bid, 0);
            console.log(`Sponsored revenue potential: $${totalRevenue.toFixed(2)}`);
            
            // Send to your analytics
            fetch('/api/track-impression', {
                method: 'POST',
                body: JSON.stringify({
                    query: document.getElementById('searchInput').value,
                    sponsored: sponsoredResults,
                    revenue: totalRevenue
                })
            });
        }

        function userHasPremium() {
            // Check if user has premium subscription
            return localStorage.getItem('premiumUser') === 'true';
        }

        function showSummaryModal(summary, url) {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000;">
                    <div style="background:white; margin:50px auto; padding:20px; width:80%; max-height:80%; overflow:auto;">
                        <h3>AI Summary: ${url}</h3>
                        <p>${summary}</p>
                        <button onclick="this.parentElement.parentElement.remove()">Close</button>
                        
                        <!-- Ad after summary -->
                        <div style="margin-top:20px;">
                            <script type="text/javascript">
                                atOptions = {
                                    'key' : 'post-summary-ad',
                                    'format' : 'smart'
                                };
                            </script>
                            <script type="text/javascript" src="//www.highperformanceformat.com/POST_SUMMARY_CODE/invoke.js"></script>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
